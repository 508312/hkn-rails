<%= @errors %>

<h1><%= link_to @course.course_name, coursesurveys_course_path(@course.dept_abbr, @course.full_course_number) %> - <%= @klass.proper_semester %></h1>

<div id="instructorbox" class="infobox">
  <h3>Instructor<%= "s" if @klass.instructors.size > 1 %></h3>
  <ul>
    <% @klass.instructors.each do |instructor| %>
      <li><%= link_to instructor.name, "Not Sure Yet" %></li>
    <% end %>
  </ul>
  <h3>TA<%= "s" if @klass.tas.size > 1 %></h3>
  <ul>
    <% @klass.tas.each do |instructor| %>
      <li><%= link_to instructor.name, "Not Sure Yet" %></li>
    <% end %>
  </ul>
</div>

<table id="ratings">
<%- @results.each do |instructor, answers| -%>
  <%- if answers.nil? -%>
  <tr>
    <th colspan="2">
      <%= link_to @klass.instructor_type(instructor)+" "+instructor.name, "FAKEURL" %>
    </th>
  </tr>
  <tr><td colspan="2">This instructor's ratings are <%= link_to "hidden", coursesurveys_ferpa_path %>.</td></tr>
  <%- else -%>
  <tr>
    <th>
      <%= link_to @klass.instructor_type(instructor)+" "+instructor.name, "FAKEURL" %>
    </th>
    <th><%= ActiveSupport::JSON.decode(answers.first.frequencies).values.reduce{|x,y| x.to_i+y.to_i} %> respondents</th>
  </tr>
    <%- answers.each do |answer| -%>
  <tr>
    <td>
      <%- if answer.survey_question.important -%><strong><%- end -%>
      <%= answer.survey_question.text %>
      <%- if answer.survey_question.important -%></strong><%- end -%>
    </td>
    <td>
      <%= sprintf "%.1f", answer.mean %> / <%= answer.survey_question.max.to_f %>
      <%= rating_bar(answer.mean/answer.survey_question.max.to_f) %>
    </td>
  </tr>
    <%- end -%>
  <%- end -%>
<%- end -%>
</table>

<p><strong>Hint:</strong> You can click on the colored rating bars to see detailed statistics on a particular rating.</p>

<a href="mailto:www-coursesurvey@hkn.eecs.berkeley.edu?subject=Comment on HKN Course Survey page http://hkn.eecs.berkeley.edu/student/CourseSurvey/courses/EE/40/">[Email HKN about this data]</a>
